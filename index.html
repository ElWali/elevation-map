
<!DOCTYPE html>
<html>
<head>
  <title>ØªØ­Ù„ÙŠÙ„ Ø£Ø¹Ù„Ù‰ Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Esri</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map { height: 100vh; }
  </style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const ESRI_API_KEY = "ğŸ”‘ Ø¶Ø¹ Ù…ÙØªØ§Ø­Ùƒ Ù‡Ù†Ø§ ğŸ”‘";

  const map = L.map('map', {
    center: [27.95, -12.58],
    zoom: 13
  });

  const esriSat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'ESRI Satellite'
  }).addTo(map);

  const esriTopo = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'ESRI Topo'
  });

  L.control.layers({ "Esri Satellite": esriSat, "Esri Topo": esriTopo }).addTo(map);

  let centerMarker, circle, elevationMarker;

  function generatePointsInCircle(center, radiusMeters, count = 100) {
    const points = [];
    for (let i = 0; i < count; i++) {
      const angle = Math.random() * 2 * Math.PI;
      const distance = Math.random() * radiusMeters;
      const dx = distance * Math.cos(angle);
      const dy = distance * Math.sin(angle);
      const deltaLat = dy / 111320;
      const deltaLng = dx / (40075000 * Math.cos(center.lat * Math.PI / 180) / 360);
      points.push([center.lat + deltaLat, center.lng + deltaLng]);
    }
    return points;
  }

  async function getElevationEsri(lat, lng) {
    const url = `https://elevation.arcgis.com/arcgis/rest/services/WorldElevation/Terrain/ImageServer/identify?f=json&geometry=${lng},${lat}&geometryType=esriGeometryPoint&returnGeometry=false&spatialReference=4326&token=${ESRI_API_KEY}`;
    const response = await fetch(url);
    const data = await response.json();
    return data.value;
  }

  map.on('click', async function(e) {
    if (centerMarker) map.removeLayer(centerMarker);
    if (circle) map.removeLayer(circle);
    if (elevationMarker) map.removeLayer(elevationMarker);

    const center = e.latlng;

    centerMarker = L.marker(center).addTo(map).bindPopup("Ù…Ø±ÙƒØ² Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©").openPopup();
    circle = L.circle(center, { radius: 1000, color: 'blue', fillOpacity: 0.1 }).addTo(map);

    const points = generatePointsInCircle(center, 1000, 100);
    let maxElevation = -Infinity;
    let highestPoint = null;

    for (const [lat, lng] of points) {
      try {
        const elevation = await getElevationEsri(lat, lng);
        if (elevation > maxElevation) {
          maxElevation = elevation;
          highestPoint = [lat, lng];
        }
      } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹:", error);
      }
    }

    if (highestPoint) {
      elevationMarker = L.marker(highestPoint, {
        icon: L.icon({
          iconUrl: "https://cdn-icons-png.flaticon.com/512/684/684908.png",
          iconSize: [32, 32],
          iconAnchor: [16, 32]
        })
      }).addTo(map)
        .bindPopup(`Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©: ${maxElevation.toFixed(2)} Ù…ØªØ±`).openPopup();
    }
  });
</script>
</body>
</html>
